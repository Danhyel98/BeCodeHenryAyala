<%- include('partials/header'); -%>

<body>
  <h2>Your Jobs Annonces here :</h2>
  <ul id="jobs-list">
    <!-- Jobs will be dynamically loaded here -->
  </ul>
</body>

<%- include('partials/footer'); -%>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    const token = localStorage.getItem('x-auth-token'); // Retrieve the token from localStorage
    if (!token) {
      console.error('No token found in localStorage.');
      document.getElementById('jobs-list').innerHTML = '<p>No token found.</p>';
      return;
    }

    fetch('/jobs', {
      method: 'GET',
      headers: {
        'Content-Type': 'application/json',
        'x-auth-token': token // Include token in request headers
      },
      credentials: 'include' // Include credentials if needed
    })
    .then(response => {
      if (!response.ok) {
        throw new Error('Network response was not ok: ' + response.statusText);
      }
      return response.json();
    })
    .then(jobs => {
      console.log('Jobs data:', JSON.stringify(jobs, null, 2)); // Debug log
      const jobsList = document.getElementById('jobs-list');
      if (jobs.length > 0) {
        jobs.forEach(job => {
          const li = document.createElement('li');
          li.innerHTML = `
            <h3>${job.title}</h3>
            <p>${job.description}</p>
          `;
          jobsList.appendChild(li);
        });
      } else {
        jobsList.innerHTML = '<p>No jobs found.</p>';
      }
    })
    .catch(error => {
      console.error('Error fetching jobs:', error);
      document.getElementById('jobs-list').innerHTML = '<p>Error loading jobs.</p>';
    });
  });



</script>